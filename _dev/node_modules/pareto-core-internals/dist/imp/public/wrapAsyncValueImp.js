"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.wrapAsyncValueImp = void 0;
function wrapAsyncValueImp(_isGuaranteedToReturnAResult, execute) {
    return {
        _execute: ($i) => {
            execute($i);
        },
        map: ($v) => {
            function rewrite(source, rewrite) {
                return wrapAsyncValueImp(_isGuaranteedToReturnAResult, ((cb) => {
                    source((v) => {
                        rewrite(v)._execute(cb);
                    });
                }));
            }
            return rewrite(execute, $v);
        },
        setCondition: ($v) => {
            function setCondition(source, rewrite) {
                return wrapAsyncValueImp(false, (cb) => {
                    source((vIn) => {
                        const res = rewrite(vIn);
                        if (res !== undefined) {
                            res._execute(cb);
                        }
                        //callback is never called
                    });
                });
            }
            return setCondition(execute, $v);
        },
        _isGuaranteedToReturnAResult: _isGuaranteedToReturnAResult
    };
}
exports.wrapAsyncValueImp = wrapAsyncValueImp;
