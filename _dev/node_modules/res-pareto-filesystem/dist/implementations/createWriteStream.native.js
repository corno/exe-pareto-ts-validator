"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.$$ = void 0;
const writeFileImp_native_1 = require("../native/writeFileImp.native");
const createContainingDirectories_native_1 = require("../native/createContainingDirectories.native");
const joinPath_native_1 = require("../native/joinPath.native");
const concat_native_1 = require("../native/concat.native");
const $$ = ($d) => {
    return ($, $c) => {
        //FIX use fs.createWriteStream
        const joinedPath = (0, joinPath_native_1.joinPath)($.path);
        let tmp = "";
        $c(($) => {
            tmp = (0, concat_native_1.concat)(tmp, $);
        });
        if ($.createContainingDirectories) {
            (0, createContainingDirectories_native_1.createContainingDirectories)(joinedPath, () => {
                (0, writeFileImp_native_1.writeFileImp)($.path, tmp, ($) => {
                    if ($[0] === "error") {
                        $d.onError($[1]);
                    }
                });
            }, ($) => {
                $d.onError({
                    error: $,
                    path: joinedPath,
                });
            });
        }
    };
};
exports.$$ = $$;
