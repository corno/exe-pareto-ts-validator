"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createContext = void 0;
const createContext = ($, $c, $i) => {
    let isFirstLine = true;
    function createSubBlock(currentIndentation, flush, $c) {
        $c({
            'line': ($_, $i2) => {
                let currentLine = currentIndentation;
                flush({});
                if (!isFirstLine) {
                    $i.consumer.onData($.newline);
                }
                isFirstLine = false;
                $i2({
                    'indent': ($_, $i3) => {
                        createSubBlock(currentIndentation + $.indentation, () => {
                            if (currentLine !== null) {
                                $i.consumer.onData(currentLine);
                                currentLine = null;
                            }
                        }, $i3);
                    },
                    'snippet': ($2) => {
                        if (currentLine !== null) {
                            currentLine += `${$2}`;
                        }
                        else {
                            $i.consumer.onData($.newline);
                            currentLine = `${currentIndentation}${$2}`;
                        }
                    },
                });
                if (currentLine !== null) {
                    $i.consumer.onData(currentLine);
                }
            },
        });
    }
    createSubBlock(``, ($) => {
        //no flushing
    }, $c);
    $i.consumer.onEnd();
};
exports.createContext = createContext;
